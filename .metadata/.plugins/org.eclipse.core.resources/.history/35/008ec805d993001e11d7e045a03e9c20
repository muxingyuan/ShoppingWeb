package com.project.survey;

import java.io.IOException;
import javax.servlet.ServletException;
import java.io.PrintWriter;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;



//@WebServlet("/SurveyQuestionServlet")
public class SurveyQuestionServlet extends HttpServlet {
	private static final long serialVersionUID = 1L;
	       
		protected final String url = "jdbc:mysql://localhost:3306/surveydb";

	    public SurveyQuestionServlet() {
	        super();

	    }


		protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
			doPost(request, response);
		}


		protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
			//doGet(request, response);
	        String surveyId = request.getParameter("surveyid");
		    response.setContentType("text/html");
			PrintWriter out = response.getWriter();

			String docType = 
					"<!DOCTYPE html PUBLIC \"-//W3C//DTD HTML 4.01" + "Transitional//EN\">\n";
			String title = "Survery Id" + surveyId+ " Questions";
			out.print(docType +
					"<HTML>\n" +
					"<BODY><CENTER>\n" +
					"<TABLE CLASS='TITLE' BORDER='5'>" +
					"<TR><TH>" + title + "</TABLE><P>");
			out.print("<FORM action='Statistics' method='post'>\n");
			showTable(out, surveyId);
			out.println("<INPUT type='submit' value='Submit'><BR>");
			out.println("</FORM>");
			out.println("</CENTER></BODY></HTML>");

			/*

		        writer.println("<html><head><title>View Cart</title>" +
		        		"</head><body><h2>View Cart</h2>");
		        
		        writer.println("</br><a href='products'>Product List</a></br>");
		        writer.println("<h3>Cart Id: " + cart_id + "</h3>");
		        
		        writer.println("<table>");
		        writer.println("<thead><th>Quantity</th><th>Product</th><th>Price</th><th>Amount</th></thead>");
		        writer.println("<tbody>");
		        for (CartLine cl1 : cartLines) {
		            writer.println("<tr><td>" + cl1.getQuantity() 
		                         + "</td><td>" + pc.getProduct(cl1.getProductId()).getName() 
		                         + "</td><td>" + pc.getProduct(cl1.getProductId()).getPrice() 
		                         + "</td><td>" + cl1.getQuantity() * pc.getProduct(cl1.getProductId()).getPrice() 
		                         + "</td></tr>"  );
		        }
		        writer.println("</tbody></table>");
		        writer.println("</body></html>");
		   */
			
		}

		protected void showTable(PrintWriter out, String surveyid) {
			try{
				Class.forName("com.mysql.jdbc.Driver");
				Connection connection = getConnection();
				Statement statement = connection.createStatement();
				String queryA = "SELECT Answer_text FROM vw_SurveyAnswer where Survery_id = " + surveyid;
				ResultSet resultSetA = statement.executeQuery(queryA);
				String queryQ = "SELECT Question_id, Question_text FROM vw_SurveyQuestion where Survey_id = " + surveyid;
				ResultSet resultSetQ = statement.executeQuery(queryQ);
				printTableTop(connection, resultSetA, out);
				//printTableBody(resultSetQ, out);
				out.println("</TABLE>");
				connection.close();
			}catch(Exception e) {
				System.err.println("Error: " + e);
			}
		}

		
		protected Connection getConnection() throws Exception {
			Connection connection = DriverManager.getConnection(url, "root","admin");
			return(connection);
		}

		
		protected void printTableTop(Connection connection, ResultSet resultSet, PrintWriter out)
		throws SQLException {
			out.println("<TABLE BORDER='1'>");
			String[] headingNames = {"","","1", "2", "3", "4", "5" };
			out.print("<TR>");
			for (String headingName : headingNames) {
				out.printf("<TH>%s", headingName);
			}
			out.println();
		}
		
		
		protected void printTableBody(ResultSet resultSet, PrintWriter out)
		throws SQLException {
			while(resultSet.next()) {
				out.println("<TR ALIGN='LEFT'>");
				out.printf("<TD>%d", resultSet.getInt("Question_id"));
				out.printf("<TD>%s", resultSet.getString("Question_text"));
				out.printf("<TD><INPUT type='radio' name='" + resultSet.getInt("Question_id") + "' value='1'");
				out.printf("<TD><INPUT type='radio' name='" + resultSet.getInt("Question_id") + "' value='2'");
				out.printf("<TD><INPUT type='radio' name='" + resultSet.getInt("Question_id") + "' value='3'");
				out.printf("<TD><INPUT type='radio' name='" + resultSet.getInt("Question_id") + "' value='4'");
				out.printf("<TD><INPUT type='radio' name='" + resultSet.getInt("Question_id") + "' value='5'");
			}
			out.println("</TABLE>");
		}

		
	}